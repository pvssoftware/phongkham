{% extends "base.html" %} {% block content %}

<div class="container">
  {% if error %}
  <h5 class="my-4" style="color: #d9534f">
    Thuốc vừa thêm đã có trong kho thuốc, hãy kiểm tra và nhập lại tên đầy đủ
    của thuốc.
  </h5>
  {% endif %}
  <h3 class="my-3">Thêm thuốc vào kho</h3>

  <form action="{% url 'medicine_create' pk_doctor %}" id="medicine_create_form" method="post">
    {% csrf_token %}
    <div class="form-group">
      <label for="name">Nhập tên thuốc<span class="required-input">*</span></label>
      <input name="name" type="text" class="form-control" id="name" placeholder="Tên của thuốc" 
      {% if form.name.value %} 
      value="{{ form.name.value }}" 
      {% endif %} />
      <span id="alert_name" style="color: #d9534f;font-size:15px"></span>
    </div>
    <div class="form-group">
      <label for="full_name">Nhập tên đầy đủ thuốc<span class="required-input">*</span></label>
      <input name="full_name" id="full_name" type="text" class="form-control" placeholder="Tên đầy đủ của thuốc" 
      {% if form.full_name.value %}
       value="{{ form.full_name.value }}"
        {% endif %} />
      <span id="alert_full_name" style="color: #d9534f;font-size:15px"></span>
    </div>
    <div class="row">
      <div class="col-md-5">
        <label for="sale_price">Giá bán<span class="required-input">*</span></label>
        <input class="form-control" type="text" name="sale_price" id="sale_price" placeholder="Nhập giá bán"
         {% if form.sale_price.value  %}
          value="{{ form.sale_price.value }}"
          {% endif %} />
        <span id="alert_sale_price" style="color: #d9534f;font-size:15px"></span>
      </div>
      <div class="col-md-5">
        <label for="import_price">Giá mua<span class="required-input">*</span></label>
        <input class="form-control" type="text" name="import_price" id="import_price" placeholder="Nhập giá mua" 
        {% if form.import_price.value %}
         value="{{ form.import_price.value }}"
        {% endif %} />
        <span id="alert_import_price" style="color: #d9534f;font-size:15px"></span>
      </div>
      <div class="col-md-2">
        <label for="quantity">Số lượng<span class="required-input">*</span></label>
        <input class="form-control" type="text" name="quantity" id="quantity" placeholder="Nhập số lượng" 
        {% if form.quantity.value %}
         value="{{ form.quantity.value }}"
       {% endif %} />
        <span id="alert_quantity" style="color: #d9534f;font-size:15px"></span>
      </div>
    </div>
    <button class="btn btn-submit mt-4" type="button">Thêm thuốc</button>

    <!-- Button trigger modal -->
    <button class="btn btn-finished mt-4 float-right" type="button" data-toggle="modal" data-target="#modelId">
      Gửi Excel
    </button>
  </form>

  <!-- Modal -->
  <div class="modal fade" id="modelId" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">TẠO DỮ LIỆU THUỐC BẰNG FILE EXCEL</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <form action="{% url 'upload_medicine_excel' pk_doctor %}" method="post" enctype="multipart/form-data"
              id="form_upload_excel">
              {% csrf_token %}
              <div class="form-group">
                <label for="file_excel">Chọn file excel</label>
                <input type="file" class="form-control-file" id="file_excel" name="file_excel" />
                <span id="alert_file_excel" style="color: #d9534f;font-size:15px"></span>
              </div>
            </form>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Đóng
          </button>
          <button type="button" class="btn btn-finished" id="bt_upload_excel">
            Gửi file
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  $(document).ready(function () {
    // validate digital
    function ValidateDigit(value) {
      regex = new RegExp("^[1-9][0-9]*$");
      var isValid = regex.test(value);
      return isValid;
    }

    $(".btn-submit").click(function () {
      var name = $("#name").val();
      var full_name = $("#full_name").val();

      var sale_price = $("#sale_price").val();
      var import_price = $("#import_price").val();
      var quantity = $("#quantity").val();
      var valid = true;

      if (name === "") {
        $("#alert_name").text("Bạn nên nhập tên thuốc");
        valid &= false;
      } else {
        $("#alert_name").text("");
      }
      if (full_name === "") {
        $("#alert_full_name").text("Bạn nên nhập tên đầy đủ thuốc");
        valid &= false;
      } else {
        $("#alert_full_name").text("");
      }
      if (!ValidateDigit(sale_price)) {
        $("#alert_sale_price").text("Bạn nên nhập giá bán của thuốc");
        valid &= false;
      } else {
        $("#alert_sale_price").text("");
      }
      if (!ValidateDigit(import_price)) {
        $("#alert_import_price").text("Bạn nên nhập giá mua vào của thuốc");
        valid &= false;
      } else {
        $("#alert_import_price").text("");
      }
      if (!ValidateDigit(quantity)) {
        $("#alert_quantity").text("Bạn nên nhập số lượng thuốc");
        valid &= false;
      } else {
        $("#alert_quantity").text("");
      }

      if (valid) {
        $("#medicine_create_form").submit();
      }
    }); // end click

    $("#bt_upload_excel").click(function () {
      var file_excel = $("#file_excel").val();
      var valid = true;

      if (file_excel === "") {
        $("#alert_file_excel").text("Bạn chưa đính kèm file excel");
        valid &= false;
      } else {
        $("#alert_file_excel").text("");
      }

      if (valid) {
        $("#form_upload_excel").submit();
      }
    }); // endclick
  });
</script>
{% endblock %}