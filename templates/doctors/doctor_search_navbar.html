{% extends "base.html" %}
{% load staticfiles %}
 {% block content %}

 <div class="container">

     
     {% if results %}
     <div class="my-3 p-3 bg-light rounded box-shadow">
      <div class="d-flex justify-content-between align-items-center border-bottom border-gray">
        <h4 class="pb-2 mb-0">Kết quả tìm kiếm</h4>
        <span class="page-link-mix" style="font-weight: bold">Dịch vụ khám</span>
      </div>
      <!--  medical record search -->
      
      {% for mrecord in results.mrecords %}
      <div class="media text-muted pt-3">
        <i class="fa fa-square mr-2"
        {% if mrecord.sex %}
          style="font-size: 47px;color: #ff4081 "
          {% else %}
          style="font-size: 47px;color: #304ffe"
          {% endif %}></i>
        <div class="media-body pb-3 mb-0 lh-125 border-bottom border-gray">
          <div class="d-flex justify-content-between align-items-center w-100">
            <strong class="text-gray-dark"><a class="page-link-mix" href="{% url 'medical_record_view' pk_doctor mrecord.pk %}">{{ mrecord.full_name }}
              {% if mrecord.phone %}
                - ĐT: {{ mrecord.phone }}
              {% endif %}
            </a></strong>
            <span class="page-link-mix">Chưa khám</span>
                        
          </div>
          <div class="d-flex justify-content-between align-items-center">
              
          </div>
          
          </div>
        
      </div>
      {% endfor %}
        
      <!-- history search -->
      {% for history in results.histories %}
      <div class="media text-muted pt-3">
          <i class="fa fa-square mr-2"
          {% if history.medical_record.sex %}
            style="font-size: 47px;color: #ff4081 "
            {% else %}
            style="font-size: 47px;color: #304ffe"
            {% endif %}></i>
          <div class="media-body pb-3 mb-0 lh-125 border-bottom border-gray">
            <div class="d-flex justify-content-between align-items-center w-100">
              <strong class="text-gray-dark"><a class="page-link-mix" href="{% url 'medical_record_view' pk_doctor history.medical_record.pk %}">{{ history.medical_record.full_name }}
                {% if history.medical_record.phone %}
                  - ĐT: {{ history.medical_record.phone }}
                {% endif %}
              </a></strong>
              <!-- {% if result.ps and result.pk %}
              <span class="page-link-mix">Phụ sản / Phụ khoa</span>
              {% elif result.ps %}
              <span class="page-link-mix">Phụ sản</span>
              {% elif result.pk %}
              <span class="page-link-mix">Phụ khoa</span>
              {% else %}
              <span class="page-link-mix">Chưa khám</span>
              {% endif %} -->
              
              {% if history.prescriptiondrugoutstock_set.all or history.prescriptiondrug_set.all %}
                <a href="{% url 'export_final_info_excel_patient' pk_doctor history.medical_record.pk history.pk %}" class="page-link-mix">Xem toa thuốc</a>
              {% endif %}
                
              
            
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <!-- {% if result.ob.sex %}
                <i class="fa fa-female"></i>
                {% else %}
                <i class="fa fa-male"></i>
                {% endif %}
            <span >{{ result.ob.birth_date |date:"Y"}}</span> -->
            <span>Lần đi khám thời gian -- <i class="fa fa-calendar"></i> {{ history.date_booked | date:"H:i D. d-m-Y" }}</span>
            <div>
            {% if settings_service.medical_ultrasonography %}
            <div>
              {% if history.medical_ultrasonography_file %}
              <a
                class="view-pdf page-link-mix"
                href="{{ history.medical_ultrasonography_file.url }}"
                >Xem file siêu âm</a
              >
              {% else %}
              Không có file siêu âm
              {% endif %}
            </div>            
            {% endif %}

            {% if settings_service.endoscopy %}
            <div>
              {% if history.endoscopy_file %}
              <a
                class="view-pdf page-link-mix"
                href="{{ history.endoscopy_file.url }}"
                >Xem file nội soi</a
              >
              {% else %}
              Không có file nội soi
              {% endif %}
            </div>
            {% endif %}

            {% if settings_service.medical_test %}
            <div>
              {% if history.medical_test_file %}
              <a
                class="view-pdf page-link-mix"
                href="{{ history.medical_test_file.url }}"
                >Xem file xét nghiệm</a
              >
              {% else %}
              Không có file xét nghiệm
              {% endif %}
            </div>           
            {% endif %}
            </div>
            
            </div>
          </div>
      </div>
      {% endfor %}
      <!-- end history search -->
    </div>
    {% else %}
    <h4 class="mt-3">Không tìm thấy bệnh nhân
      
      {% if date_obj %}
        nào khám trong ngày {{ date_obj | date:"d-m-Y" }}
      {% endif %}
        
    </h4>
     {% endif %}
       
         
 </div>
 <script src="{% static 'js/easy-modal-plugin.js' %}"></script>
<script>
$(document).ready(function(){
  // modal plugin
  $(function() {
      $(".view-pdf").on("click", function() {
        var pdf_link = $(this).attr("href");
        console.log(pdf_link);
        // var iframe = '<div class="iframe-container"><iframe src="'+pdf_link+'"></iframe></div>'
        // var iframe = '<object data="'+pdf_link+'" type="application/pdf"><embed src="'+pdf_link+'" type="application/pdf" /></object>'
        var iframe =
          '<object type="application/pdf" data="' +
          pdf_link +
          '" width="100%" height="600">No Support</object>';
        $.createModal({
          title: "Xem file",
          message: iframe,
          closeButton: true,
          scrollable: false
        });
        return false;
      });
    }); //end modal
});//
</script>
 {% endblock %}