{% extends "base.html" %}
 {% block content %}

<div class="container">
        {% if error %}
        <h5 class="my-4" style="color: #d9534f">
          Thuốc vừa thay đổi thông tin đã có tên biệt dược trùng với thuốc khác trong kho thuốc, hãy kiểm tra và nhập lại tên biệt dược
          của thuốc.
        </h5>
        {% endif %}
    <h3 class="my-3">Sửa thông tin thuốc</h3>

    <form action="{% url 'medicine_edit' pk_doctor pk_medicine %}" id="medicine_edit_form" method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="name">Sửa tên thuốc<span class="required-input">*</span></label>
            <input name="name" id="name" type="text" class="form-control" value="{{ form.name.value }}" placeholder="Sửa tên của thuốc">
            <span id="alert_name" style="color: #d9534f;font-size:15px"></span>
        </div>
        <div class="form-group">
            <label  for="full_name">Sửa tên biệt dược của thuốc<span class="required-input">*</span></label>
            <input name="full_name" id="full_name" type="text" class="form-control" value="{{ form.full_name.value }}" placeholder="Sửa tên biệt dược của thuốc">
            <span id="alert_full_name" style="color: #d9534f;font-size:15px"></span>
        </div>
        <div class="row">
            <div class="col-md-3">
                <label for="sale_price">Giá bán<span class="required-input">*</span></label>
                <input class="form-control" value="{{ form.sale_price.value }}" type="text" name="sale_price" id="sale_price" placeholder="Sửa giá bán">
                <span id="alert_sale_price" style="color: #d9534f;font-size:15px"></span>
            </div>
            <div class="col-md-3">
                <label for="import_price">Giá mua<span class="required-input">*</span></label>
                <input class="form-control" value="{{ form.import_price.value }}" type="text" name="import_price" id="import_price" placeholder="Sửa giá mua">
                <span id="alert_import_price" style="color: #d9534f;font-size:15px"></span>
            </div>
            <div class="col-md-2">
                <label for="date_expired">Ngày hết hạn</label>
                <input class="form-control" type="text" name="date_expired" id="date_expired" placeholder="Nhập ngày hết hạn" autocomplete="off"
                {% if form.date_expired.value %}
                 value="{{ form.date_expired.value }}"
                {% endif %} />
                <span id="alert_date_expired" style="color: #d9534f;font-size:15px"></span>
              </div>
            <div class="col-md-2">
                <label for="quantity">Số lượng trong kho</label>
                <input class="form-control" type="text" value="{{ medicine.quantity }}" id="quantity" disabled>
            </div>
            <div class="col-md-2">
                <label for="add_quantity">Số lượng thêm vào<span class="required-input">*</span></label>
                <input class="form-control" type="text" name="add_quantity" id="add_quantity" placeholder="Thêm số lượng"
                {% if form.add_quantity.value  %}
                value="{{ form.add_quantity.value }}"
                {% endif %} >
                <span id="alert_add_quantity" style="color: #d9534f;font-size:15px"></span>
            </div>
        </div>
        <button class="btn btn-submit mt-3" type="button">Cập nhật</button>
        <button class="btn btn-del mt-3 float-right" type="button"><a href="{% url 'medicine_del' pk_doctor pk_medicine %}">Xoá thuốc</a></button>
    </form>
    
</div>
<script>
$(document).ready(function(){
    // validate digital
    function ValidateDigit(value){
        regex = new RegExp("^[1-9][0-9]*$");
        var isValid =  regex.test(value);
        return isValid;
    }
    function ValidateQuantityDigit(value){
        regex = new RegExp("^(-\\d*|\\d*)$");
        var isValid =  regex.test(value);
        return isValid;
    }
    // validate datetime format dd/mm/Y
    function ValidateDate(value) {
      regex = new RegExp(
        "^([0-2]\\d{1}|3[0-1])\\/(0\\d{1}|1[0-2])\\/(19|20)\\d{2}$"
      );
      var isValid = regex.test(value);
      return isValid;
    }

    $(".btn-submit").click(function(){
        var name = $("#name").val();
        var full_name = $("#full_name").val();
        console.log(full_name);
        var sale_price = $("#sale_price").val();
        var import_price = $("#import_price").val();
        var add_quantity = $("#add_quantity").val();
        var date_expired = $("#date_expired").val();
        var valid = true;

        if(name ===""){
            $("#alert_name").text("Bạn nên nhập tên thuốc");
            valid &= false;
        } else{
            $("#alert_name").text("");
        }
        if(full_name ===""){
            $("#alert_full_name").text("Bạn nên nhập tên đầy đủ thuốc");
            valid &= false;
        } else{
            $("#alert_full_name").text("");
        }
        if(!ValidateDigit(sale_price)){
            $("#alert_sale_price").text("Bạn nên nhập giá bán của thuốc");
            valid &= false;
        } else{
            $("#alert_sale_price").text("");
        }
        if(!ValidateDigit(import_price)){
            $("#alert_import_price").text("Bạn nên nhập giá mua vào của thuốc");
            valid &= false;
        } else{
            $("#alert_import_price").text("");
        }
        if(!ValidateQuantityDigit(add_quantity)){
            $("#alert_add_quantity").text("Giá trị không hợp lệ");
            valid &= false;
        } else{
            $("#alert_add_quantity").text("");
        }
        if (date_expired==""){
            $("#alert_date_expired").text("");
        } else if (!ValidateDate(date_expired)) {
            $("#alert_date_expired").text("Thời gian không hợp lệ");
            valid &= false;
        } else {
            $("#alert_date_expired").text("");
        }

        if(valid){
          $(this).prop("disabled",true);
          $("#medicine_edit_form").submit();  
        }
        
    }); // end click

    // date picker
    $("#date_expired").datepicker({
      // constrainInput: false,
      dateFormat: "dd/mm/yy",
      changeMonth: true,
      // changeYear: true,
      // yearRange:"-90:+0",
      monthNames: [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "10",
        "11",
        "12"
      ],
      monthNamesShort: [
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "10",
        "11",
        "12"
      ]
    }); // end datepicker
});
</script>
 {% endblock %}