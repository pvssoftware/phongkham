{% extends "base.html" %}
 {% block content %}

 <div class="container">
     <h3 class="mt-3">Tạo ngày và giờ khám chữa bệnh</h3>

     <form action="{% url 'create_weekday' doctor.user.pk %}" class="opening-time" method="post" id="form_settings">
         {% csrf_token %}

         <div class="form-row">
             <div class="form-group col-sm-4">
                <label for="">Chọn ngày</label>
                <select name="day" id="day" class="form-control">
                    <option value="mon">Thứ Hai</option>
                    <option value="tue">Thứ Ba</option>
                    <option value="wed">Thứ Tư</option>
                    <option value="thu">Thứ Năm</option>
                    <option value="fri">Thứ Sáu</option>
                    <option value="sat">Thứ Bảy</option>
                    <option value="sun">Chủ Nhật</option>
                </select>
             </div>
             <div class="form-group col-sm-4">
                <label for="opening_time">Giờ mở cửa</label>
                
                    
                <input type="text" class="form-control timepicker" id="opening_time" name="opening_time" 
                
                {% if form %}
                    value="{{ form.opening_time.value }}"
                {% endif %}
                    >
                <small id="alert_opening_time" class="text-muted" style="color: #d9534f !important;">
                    
                    {% if form %}
                        Thời gian không hợp lệ!
                    {% endif %}
                        
                </small>

              </div>
             <div class="form-group col-sm-4">
                <label for="closing_time">Giờ đóng cửa</label>
                <input type="text" class="form-control timepicker" id="closing_time" name="closing_time" 
                
                {% if form %}
                    value="{{ form.closing_time.value }}"
                {% endif %}
                >
                <small id="alert_closing_time" class="text-muted" style="color: #d9534f !important;">
                    {% if form %}
                    Thời gian không hợp lệ!
                    {% endif %} 
                </small>
              </div>
         </div>
         <button class="btn btn-submit my-3" type="button">Xác nhận</button>
         <button class="btn btn-finished float-right my-3"><a href="{% url 'settings_openingtime' doctor.user.pk %}">Trở lại</a> </button>
     </form>
 </div>
<script>
$(document).ready(function(){
    // Time picker
    $(".timepicker").datetimepicker({
        datepicker: false,
        format: "H:i",
        step: 30,
        // mask:true
    }); // end datetimepicker

    // Function return time object
    function time_working(params1=null,params2=null) {
        opening = new Date();
        closing = new Date();
        if (params1) {
           return opening.setHours(parseInt(params1.split(":")[0]),parseInt(params1.split(":")[1])) 
        } else {
            return closing.setHours(parseInt(params2.split(":")[0]),parseInt(params2.split(":")[1])) 
        }
        
    }

    // Valid function
    function ValidTime(time_opening,time_closing,alert_opening,alert_closing) {
        if(time_opening !== "" && time_closing !== ""){
                if (time_working(params1=time_opening,params2=null) >= time_working(params1=null,params2=time_closing)){
                    
                    $(alert_opening).text("Không hợp lệ!");
                    $(alert_closing).text("Không hợp lệ!");
                    return false
                } else {
                    $(alert_opening).text("");
                    $(alert_closing).text("");
                    return true
                }
        } else if (time_opening !== "") {
                    console.log("opening");
                    
                    $(alert_opening).text("");
                    $(alert_closing).text("Chưa điền giờ!");
                    return false
        } else if (time_closing !== "") {
                    
                    $(alert_opening).text("Chưa điền giờ!");
                    $(alert_closing).text("");
                    return false
        } else {
                $(alert_opening).text("Chưa điền giờ!");
                $(alert_closing).text("Chưa điền giờ!");
                return false
        }
    }

    // submit form
    $(".btn-submit").click(function(){
        var valid = true;
        var opening_time = $("#opening_time").val();
        var closing_time = $("#closing_time").val();

        valid &= ValidTime(opening_time,closing_time,"#alert_opening_time","#alert_closing_time");

        if(valid){
            $("#form_settings").submit();
        }

    }); // end submit
});
</script>
 {% endblock %}