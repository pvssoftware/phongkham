{% extends "base.html" %}
 {% block content %}

<div class="container">
    <h3 class="mt-3">Tạo hồ sơ bệnh nhân</h3>

    <form action="{% url 'medical_record_create' pk_doctor %}" id="mrecord_create_form" method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="full_name">Họ và tên<span class="required-input">*</span></label>
                <input type="text" name="full_name" class="form-control" placeholder="Họ và tên" id="full_name"
                
                {% if form.full_name.value %}
                   value="{{ form.full_name.value }}" 
                {% endif %}                    
                >
                <span id="alert_full_name" style="color: #d9534f;font-size:15px"></span>
            </div>
            <div class="col-md-2 mb-3">
                <label for="birth_date">Năm sinh<span class="required-input">*</span></label>
                <input type="text" id="birth_date" name="birth_date" class="form-control" placeholder="Năm sinh" id="birth_date" autocomplete="off"
                {% if form.birth_date.value %}
                value="{{ form.birth_date.value }}" 
                {% endif %}>
                <span id="alert_birth_date" style="color: #d9534f;font-size:15px"></span>
            </div>
            <div class="col-md-2 mb-3">
                <label for="phone">Điện thoại<span class="required-input">*</span></label>
                <input type="text" id="phone" name="phone" class="form-control" placeholder="Số điện thoại" id="phone"
                {% if form.phone.value %}
                value="{{ form.phone.value }}" 
                {% endif %}>
                {% for error in form.phone.errors %}
                <span id="alert_phone" style="color: #d9534f;font-size:13px">{{ error }}</span>
                {% endfor %}
            </div>
            <div class="col-md-2 mb-3">
                <label for="password">Mật khẩu</label>
                <input type="text" id="password" name="password" class="form-control" placeholder="Mật khẩu" id="password"
                {% if form.password.value %}
                value="{{ form.password.value }}" 
                {% endif %}>
                {% for error in form.password.errors %}
                <span id="alert_phone" style="color: #d9534f;font-size:13px">{{ error }}</span>
                {% endfor %}
            </div>
        </div>
        <div class="mb-3">
            <label for="address">Địa chỉ<span class="required-input">*</span></label>
            <input type="text" id="address" name="address" class="form-control" placeholder="Địa chỉ" id="address"
            {% if form.address.value %}
                value="{{ form.address.value }}" 
            {% endif %}>
            
            <span id="alert_address" style="color: #d9534f;font-size:15px"></span>
            
        </div>
        <div class="row">
            <div class="col-md-3 mb-3">
                <p class="mb-0">Giới tính</p>
                <div>
                    <label class="custom_radio mr-4">
                        <input type="radio" name="sex" value="0"
                        {% if form.sex.value == "0" %}
                            checked
                        {% endif %}>
                        <span>Nam</span>
                    </label>
                    <label class="custom_radio">
                        <input type="radio" name="sex" value="1"
                        {% if form.sex.value == "1" %}
                            checked
                        {% endif %}
                        {% if not form.sex.value %}
                            checked
                        {% endif %}>
                        <span>Nữ</span>
                    </label>
                </div>
            </div>
        </div>
        
        <button class="btn btn-submit" type="button">Tạo hồ sơ</button>
    </form>
</div>

<script>
$(document).ready(function(){
    // validate datetime format dd/mm/Y
    // function ValidateDate(value){
    //   regex = new RegExp("^([0-2]\\d{1}|3[0-1])\\/(0\\d{1}|1[0-2])\\/(19|20)\\d{2}$");
    //   var isValid = regex.test(value);
    //   return isValid;
    // }
    function ValidateDate(value){
      regex = new RegExp("^(19|20)\\d{2}$");
      var isValid = regex.test(value);
      return isValid;
    }

    // Kiem tra dinh dang cho chu
    function ValidateWord(value){
        regex = new RegExp("^[a-zA-Z_ÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêếìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶ" + "ẸẺẼỀỀỂẾưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợ" + "ụủứừỬỮỰỲỴÝỶỸửữựỳỵỷỹý\\s]+$");
        var isValid =  regex.test(value);
        return isValid;
    }
    // date picker
    // $("#birth_date").datepicker({
    // dateFormat: "dd/mm/yy",
    // changeMonth: true,
    // changeYear: true,
    // yearRange:"-90:+0",
    // monthNames: ["1","2","3","4","5","6","7","8","9","10","11","12"],
    // monthNamesShort: ["1","2","3","4","5","6","7","8","9","10","11","12"]
    // });// end datepicker

    $(".btn-submit").click(function(){
        var full_name = $("#full_name").val();
        var birth_date = $("#birth_date").val();
        var address = $("#address").val();

        var valid = true;

        if(!ValidateWord(full_name)){
            $("#alert_full_name").text("Tên nhập không hợp lệ");
            valid &= false;
        } else{
            $("#alert_full_name").text("");
        }
        if(address ===""){
            $("#alert_address").text("Bạn chưa nhập địa chỉ");
            valid &= false;
        } else{
            $("#alert_address").text("");
        }

        if(!ValidateDate(birth_date)){
            $("#alert_birth_date").text("Năm sinh không hợp lệ");
            valid &= false;
        } else{
            $("#alert_birth_date").text("");
        }

        if(valid){
            $(this).prop("disabled",true);
            $("#mrecord_create_form").submit();
        }
        
    }); // end click


    
}); // end ready
</script>

 {% endblock %}