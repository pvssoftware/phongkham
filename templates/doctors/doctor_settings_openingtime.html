{% extends "base.html" %}
 {% block content %}

<div class="container my-3" style="border: solid #f7f7f9;border-width: 3px;">
    <h3 class="mt-3">Cài đặt giờ khám chữa bệnh</h3>

    <form action="{% url 'settings_openingtime' doctor.user.pk %}" method="post" id="form_settings">
        {% csrf_token %}
        <div class="form-check my-3">
            <input class="form-check-input" type="checkbox" id="enable_voice" name="enable_voice" 

            {% if doctor.settings_time.enable_voice %}
                checked
            {% endif %}
            >
            <label class="form-check-label" for="enable_voice" id="enable_label">
              Kích hoạt dịch vụ đặt lịch khám bằng điện thoại
            </label>
        </div>
        <div class="form-group d-flex justify-content-between align-items-center opening-time">
            <label for="examination_period" class="align-self-center day-label">Thời gian dự kiến khám cho mỗi bệnh nhân</label>
            <div class="" style="width: 100px;">
              <input type="text" class="form-control" id="examination_period" aria-describedby="helptext" name="examination_period" placeholder="Số phút" 
              
              {% if doctor.settings_time.examination_period %}
                    value="{{doctor.settings_time.examination_period}}"
                {% endif %}>
              <small id="alert_examination_period"  class="text-muted" style="color: #d9534f !important;"></small>
            </div>
            
        </div>
        <button class="btn btn-submit my-3" type="button">Xác nhận</button>
    </form>
    
    {% if doctor.settings_time %}
    <table class="table opening-time mt-3">
        <thead>
            <tr>
                <th><button class="btn btn-finished btn-sm"><a href="{% url 'create_weekday' doctor.user.pk %}">Thêm</a> </button></th>
                <th>Mở cửa</th>
                <th>Đóng cửa</th>
                <th></th>
            </tr>
        </thead>
        
        <tbody>
        {% for name_day, days in days.items %}
            
            {% if name_day == "mon" %}                
                {% for day in days %}
                <tr>
                    <th scope="row">Thứ Hai</th>
                    <td>{{ day.opening_time|date:'H:i' }}</td>
                    <td>{{ day.closing_time|date:'H:i' }}</td>
                    <td><a class="icon_remove" href="{% url 'delete_weekday' doctor.user.pk day.pk %}"><i class="fa fa-trash"></i></a></td>
                </tr>
                {% endfor %}                            
            {% endif %}
            {% if name_day == "tue" %}                
                {% for day in days %}
                <tr>
                    <th scope="row">Thứ Ba</th>
                    <td>{{ day.opening_time|date:'H:i' }}</td>
                    <td>{{ day.closing_time|date:'H:i' }}</td>
                    <td><a class="icon_remove" href="{% url 'delete_weekday' doctor.user.pk day.pk %}"><i class="fa fa-trash"></i></a></td>
                </tr>
                {% endfor %}                            
            {% endif %}
            {% if name_day == "wed" %}                
                {% for day in days %}
                <tr>
                    <th scope="row">Thứ Tư</th>
                    <td>{{ day.opening_time|date:'H:i' }}</td>
                    <td>{{ day.closing_time|date:'H:i' }}</td>
                    <td><a class="icon_remove" href="{% url 'delete_weekday' doctor.user.pk day.pk %}"><i class="fa fa-trash"></i></a></td>
                </tr>
                {% endfor %}                            
            {% endif %}
            {% if name_day == "thu" %}                
                {% for day in days %}
                <tr>
                    <th scope="row">Thứ Năm</th>
                    <td>{{ day.opening_time|date:'H:i' }}</td>
                    <td>{{ day.closing_time|date:'H:i' }}</td>
                    <td><a class="icon_remove" href="{% url 'delete_weekday' doctor.user.pk day.pk %}"><i class="fa fa-trash"></i></a></td>
                </tr>
                {% endfor %}                            
            {% endif %}
            {% if name_day == "fri" %}                
                {% for day in days %}
                <tr>
                    <th scope="row">Thứ Sáu</th>
                    <td>{{ day.opening_time|date:'H:i' }}</td>
                    <td>{{ day.closing_time|date:'H:i' }}</td>
                    <td><a class="icon_remove" href="{% url 'delete_weekday' doctor.user.pk day.pk %}"><i class="fa fa-trash"></i></a></td>
                </tr>
                {% endfor %}                            
            {% endif %}
            {% if name_day == "sat" %}                
                {% for day in days %}
                <tr>
                    <th scope="row">Thứ Bảy</th>
                    <td>{{ day.opening_time|date:'H:i' }}</td>
                    <td>{{ day.closing_time|date:'H:i' }}</td>
                    <td><a class="icon_remove" href="{% url 'delete_weekday' doctor.user.pk day.pk %}"><i class="fa fa-trash"></i></a></td>
                </tr>
                {% endfor %}                            
            {% endif %}
            {% if name_day == "sun" %}                
                {% for day in days %}
                <tr>
                    <th scope="row">Chủ Nhật</th>
                    <td>{{ day.opening_time|date:'H:i' }}</td>
                    <td>{{ day.closing_time|date:'H:i' }}</td>
                    <td><a class="icon_remove" href="{% url 'delete_weekday' doctor.user.pk day.pk %}"><i class="fa fa-trash"></i></a></td>
                </tr>
                {% endfor %}                            
            {% endif %}
                
        {% endfor %}    
        </tbody>
        
            
    </table> 
    {% endif %}
        
    
</div>

<script>
$(document).ready(function(){
    // validate digital
    function ValidateDigit(value) {
      regex = new RegExp("^[1-9][0-9]*$");
      var isValid = regex.test(value);
      return isValid;
    }

    // check whenther voice service enabled or not
    if($("#enable_voice").prop("checked")){
        $(".timepicker").prop("disabled",false);
        $("#examination_period").prop("disabled",false);
        $(".day-label").css("color","");
        $("#enable_label").css("color","");
    } else{
        $(".timepicker").prop("disabled",true);
        $("#examination_period").prop("disabled",true);
        $(".day-label").css("color","#e9ecef");
        $("#enable_label").css("color","#d9534f");
            
    }

    // enable voice service
    $("#enable_voice").click(function(){
        if($(this).prop("checked")){
            $(".timepicker").prop("disabled",false);
            $("#examination_period").prop("disabled",false);
            $(".day-label").css("color","");
            $("#enable_label").css("color","");
        } else{
            $(".timepicker").prop("disabled",true);
            $("#examination_period").prop("disabled",true);
            $(".day-label").css("color","#e9ecef");
            $("#enable_label").css("color","#d9534f");
            
        }
    }) ; // end click

    $(".btn-submit").click(function(){
        var valid = true;
        var examination_period = $("#examination_period").val();
        var enable_voice = $("#enable_voice").prop("checked");

        if(enable_voice == true){
            if (!ValidateDigit(examination_period)){
                $("#alert_examination_period").text("Không hợp lệ!");
                valid &= false;
            } else {
                $("#alert_examination_period").text("");
            }

            if(valid){
                $("#form_settings").submit(); 
            } 

        } else{
            $("#form_settings").submit();
        }
    }); // end click
}); // end click
</script>

{% endblock %}